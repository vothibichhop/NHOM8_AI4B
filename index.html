<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Nh·∫≠n di·ªán v·∫≠t c·∫£n cho ng∆∞·ªùi khi·∫øm th·ªã</title>

  <!-- Th∆∞ vi·ªán TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image"></script>

  <style>
    body {
      font-family: Arial;
      text-align: center;
      background: #eef2f3;
      padding-top: 20px;
    }
    video {
      border-radius: 10px;
      box-shadow: 0 0 10px #aaa;
    }
    #warning {
      font-size: 28px;
      font-weight: bold;
      padding: 15px;
      margin-top: 20px;
      background: red;
      color: white;
      border-radius: 10px;
      display: none;
    }
    #label {
      font-size: 22px;
      margin-top: 15px;
    }
  </style>
</head>

<body>

  <h2>H·ªá th·ªëng nh·∫≠n di·ªán v·∫≠t c·∫£n</h2>

  <video id="webcam" width="350" height="260" autoplay playsinline></video>

  <div id="label">ƒêang t·∫£i m√¥ h√¨nh...</div>

  <div id="warning">‚ö† C·∫¢NH B√ÅO: C√≥ v·∫≠t c·∫£n ph√≠a tr∆∞·ªõc!</div>

  <!-- √Çm thanh c·∫£nh b√°o -->
  <audio id="alertSound" src="obstacle.mp3"></audio>

  <!------------------------ CODE NH·∫¨N DI·ªÜN ------------------------->
  <script>
    // üëâ THAY LINK M√î H√åNH C·ª¶A B·∫†N V√ÄO ƒê√ÇY
    const URL = "https://teachablemachine.withgoogle.com/models/XXXXXXX/";

    let model, maxPredictions;
    let warningActive = false;

    async function init() {
        try {
            model = await tmImage.load(URL + "model.json", URL + "metadata.json");
            maxPredictions = model.getTotalClasses();
            document.getElementById("label").innerHTML = "M√¥ h√¨nh ƒë√£ t·∫£i!";
        } catch (e) {
            document.getElementById("label").innerHTML = "‚ùå Kh√¥ng t·∫£i ƒë∆∞·ª£c m√¥ h√¨nh!";
            console.error(e);
            return;
        }

        const webcam = document.getElementById("webcam");

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            webcam.srcObject = stream;

            webcam.addEventListener("loadeddata", () => {
                predict();
            });
        } catch (err) {
            alert("Kh√¥ng b·∫≠t ƒë∆∞·ª£c webcam! H√£y Allow camera ho·∫∑c ch·∫°y b·∫±ng HTTPS.");
            console.error(err);
        }
    }

    async function predict() {
        const webcam = document.getElementById("webcam");
        const prediction = await model.predict(webcam);

        let bestLabel = "";
        let bestProb = 0;

        prediction.forEach(p => {
            if (p.probability > bestProb) {
                bestProb = p.probability;
                bestLabel = p.className;
            }
        });

        document.getElementById("label").innerHTML =
            "Nh·∫≠n di·ªán: <b>" + bestLabel + "</b> (" + Math.round(bestProb * 100) + "%)";

        if (bestProb > 0.8 && bestLabel !== "Kh√¥ng v·∫≠t c·∫£n") {
            showWarning();
        } else {
            hideWarning();
        }

        requestAnimationFrame(predict);
    }

    function showWarning() {
        const warningDiv = document.getElementById("warning");
        const sound = document.getElementById("alertSound");

        warningDiv.style.display = "block";

        if (!warningActive) {
            sound.play();
            warningActive = true;
        }
    }

    function hideWarning() {
        document.getElementById("warning").style.display = "none";
        warningActive = false;
    }

    init();
  </script>

</body>
</html>
